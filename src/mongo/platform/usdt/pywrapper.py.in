#!/usr/bin/python3

import os
import subprocess
import sys

cpp_wr, py_rd = os.pipe()
py_wr, cpp_rd = os.pipe()

rp = os.path.realpath(__file__)
dn = os.path.dirname(rp)

exec_cpp_name = os.path.join(dn, '@usdt_probe_test_cpp@')
print(exec_cpp_name)
cpp_pr = subprocess.Popen(args=[exec_cpp_name, "{}".format(cpp_wr), "{}".format(cpp_rd)], executable=exec_cpp_name, close_fds=False)

exec_py_name = os.path.join(dn, '@usdt_probe_test_py@')
print(exec_py_name)
py_pr = subprocess.Popen(args=[exec_py_name, "{}".format(py_wr), "{}".format(py_rd), "{}".format(cpp_pr)], executable=exec_py_name, close_fds=False)

cpp_pr.wait()
os.close(cpp_wr)
os.close(cpp_rd)

py_pr.wait()
os.close(py_wr)
os.close(py_rd)

print("Donezo")
